@*@model FoodMvc.Areas.Member.Models.tMemeber*@
@model FoodDeliveryTemplete.ViewModel.RestaurantRegistedViewModel
@{
    ViewBag.Title = "食速列車-餐廳會員註冊";
    Layout = "~/Views/Register/_RegisterPage.cshtml";
}
@section style{
    <style>
        .centered-form {
            margin-top: 60px;
        }

            .centered-form .panel {
                background: rgba(255, 255, 255, 0.8);
                box-shadow: rgba(0, 0, 0, 0.3) 20px 20px 20px;
            }

        .thumb {
            width: 250px;
        }

        .bg {
            display: inline;
            position: fixed;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1000;
            top: 0;
            left: 0;
            opacity: 0.7;
        }

        .self-control {
            background-color: white;
        }

            .self-control input {
                border-color: #5bc0de;
                border-radius: 5px;
                width: 80%;
            }

        .form-horizontal label {
            color: #ff6a00;
            font-family: '標楷體';
            font-size: 16px;
        }

        .form-group select {
            border-color: #5bc0de;
            border-radius: 5px;
            width: 80%;
        }
    </style>
}


<div class="bg"></div><!--登入效果黑屏-->
<div class="container">
    <div class="row centered-form">
        <div class="row">
            <div class="col-md-6 col-md-offset-3 col-sm-4 col-sm-offset-0" style="z-index:1001">
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        <h2 style="font-size:20px;text-align:center" class="panel-title">餐廳會員註冊表單<small></small></h2>
                    </div>
                    <div class="panel-body self-control">

                        @using (Html.BeginForm("RestaurantRegisted", "Register", FormMethod.Post, new { @class = "form-horizontal", enctype = "multipart/form-data" }))
                        {
                            <div class="form-group">
                                @Html.LabelFor(m => m.fEmail, new { @class = "col-sm-3 control-label", style = "padding-top:14px;" })
                                <div class="col-sm-9">
                                    @Html.EditorFor(m => m.fEmail, new { htmlAttributes = new { @class = "form-control", placeholder = "電子郵件" } })
                                    @Html.ValidationMessageFor(m => m.fEmail, "", new { @class = "text-danger" })
                                </div>
                            </div>


                            <div class="form-group">
                                @Html.LabelFor(m => m.fPassword, new { @class = "col-sm-3 control-label", style = "padding-top:14px;" })
                                <div class="col-sm-9">
                                    @Html.EditorFor(m => m.fPassword, new { htmlAttributes = new { @class = "form-control", placeholder = "密碼" } })
                                    @Html.ValidationMessageFor(m => m.fPassword, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(m => m.fPasswordConfirm, new { @class = "col-sm-3 control-label", style = "padding-top:14px;" })
                                <div class="col-sm-9">
                                    @Html.EditorFor(m => m.fPasswordConfirm, new { htmlAttributes = new { @class = "form-control", placeholder = "密碼確認" } })
                                    @Html.ValidationMessageFor(m => m.fPasswordConfirm, "", new { @class = "text-danger" })
                                </div>
                            </div>



                            <div class="form-group">
                                @*@Html.Label("餐廳名稱",new { @class = "col-sm-2 control-label" })*@
                                @Html.LabelFor(m => m.fMemeberName, new { @class = "col-sm-3 control-label", style = "padding-top:14px;" })
                                <div class="col-sm-9">
                                    @Html.EditorFor(m => m.fMemeberName, new { htmlAttributes = new { @class = "form-control", placeholder = "餐廳名稱" } })
                                    @Html.ValidationMessageFor(m => m.fMemeberName, "", new { @class = "text-danger" })
                                </div>
                            </div>


                            <div class="form-group">
                                @*@Html.Label("創店時間", new { @class = "col-sm-2 control-label" })*@
                                @Html.LabelFor(m => m.fBirth, new { @class = "col-sm-3 control-label", style = "padding-top:14px;" })
                                <div class="col-sm-9">
                                    @Html.EditorFor(m => m.fBirth, new { htmlAttributes = new { type = "date", @class = "form-control", placeholder = "創店時間" } })
                                    @Html.ValidationMessageFor(m => m.fBirth, "", new { @class = "text-danger" })
                                </div>
                            </div>


                                @*<div class="form-group">
                                        @Html.LabelFor(m => m.fPhone, new { @class = "col-sm-3 control-label" })
                                        <div class="col-sm-9">
                                            @Html.EditorFor(m => m.fPhone, new { htmlAttributes = new { @class = "form-control", placeholder = "手機" } })
                                            @Html.ValidationMessageFor(m => m.fPhone, "", new { @class = "text-danger" })
                                        </div>
                                    </div>*@

                                <div class="form-group">
                                    @Html.LabelFor(m => m.fTel, new { @class = "col-sm-3 control-label", style = "padding-top:14px;" })
                                    <div class="col-sm-9">
                                        @Html.EditorFor(m => m.fTel, new { htmlAttributes = new { @class = "form-control", placeholder = "餐廳電話" } })
                                        @Html.ValidationMessageFor(m => m.fTel, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="form-group">
                                    @Html.Label("餐廳所在城市", new { @class = "col-sm-3 control-label", style = "padding-top:14px;" })
                                    <div class="col-sm-9">
                                        @{
                                            var city = new SelectList(ViewBag.datas, "fCityID", "fCityName");
                                        }
                                        @Html.DropDownList("fCityID", city, "請選擇城市", new { id = "fCityID", @class = "form-control" })

                                    </div>
                                </div>

                                <div class="form-group">
                                    @Html.LabelFor(m => m.fAreaID, new { @class = "col-sm-3 control-label", style = "padding-top:14px;" })
                                    <div class="col-sm-9">
                                        <select class="form-control" id="fAreaID" name="fAreaID"><option></option></select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    @Html.LabelFor(m => m.fAddress, new { @class = "col-sm-3 control-label", style = "padding-top:14px;" })
                                    <div class="col-sm-9">
                                        @Html.EditorFor(m => m.fAddress, new { htmlAttributes = new { @class = "form-control", placeholder = "店址" } })
                                        @Html.ValidationMessageFor(m => m.fAddress, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="form-group">
                                    @Html.LabelFor(m => m.fPhotoID, new { @class = "col-sm-3 control-label", style = "padding-top:14px;" })
                                    <div class="col-sm-9">
                                        <input type="file" class="form-control" placeholder="照片" id="memberPhoto" name="memberPhoto" />
                                        <br />
                                        @ViewBag.message
                                        <div id="photozone" class="col-md-4">

                                        </div>
                                    </div>

                                </div>
                                <div class="form-group">
                                    <div class="col-md-6 col-md-offset-3">
                                        <div id="map3" style="width:200px;height:180px"></div>
                                        
                                        <button type="button" class="btn btn-warning" id="check_lat_lng" style="width:100%">確認位置</button><input value="" type="hidden" class="lat" id="fLatitude" name="fLatitude" /><input value="" type="hidden" class="lng"  id="fLongitude" name="fLongitude" />
                                        <h3 style="color:#ff0000">要按確認位置才能把座標寫入</h3>
                                        <button type="submit" class="btn btn-info" style="width:100%">註冊</button>
                                    </div>
                                </div>
                                            }
                        <button type="button" class="btn btn-success" id="demo">Demo</button>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@section script{
    @*使用 google map Javascript API要套用的js有API金鑰*@
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDe_ZqLA_LQ1fN2Y7CN7FmlrmZw6i8_7Qc"></script>


    <script>
        var thefile = this.File;
        $(document).ready(function () {
            //----------連動下拉是選單-------
            $('#fCityID').change(function () {
                $.ajax({
                    type: 'post',
                    url: '@Url.Action("GetArea","Register")',
                    data: { id: $('#fCityID').val() },
                    success: function (data) {
                        $('#fAreaID').empty();
                        //$('#fCityID option[value=""]').remove();
                        $.each(data, function (idx, area) {
                            $('#fAreaID').append('<option Value ="' + area.Value + '">' + area.Text + '</option>')
                        })
                    }
                })
            })


            //------預覽上傳圖片--------
            $('#memberPhoto').change(function () {

                var thefile = this.files[0];

                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#photozone').empty();
                    //console.log(e.target.result);
                    var filecontent = e.target.result;

                    var imgobj = $("<img/>");
                    imgobj.attr({ 'src': filecontent, 'class': 'thumb' });
                    $('#photozone').append(imgobj);
                }
                reader.readAsDataURL(thefile);
            })

            //------------驗證信箱是否被註冊過
            $('#fEmail').blur(function () {
                var email = $(this).val();

                $.getJSON('@Url.Action("ValidEmail","Register")', { "email": email }, function (data) {
                    $('span[data-valmsg-for="fEmail"]').text(data)
                })


            })


            $('#map3').css("display", "none");


            $('#check_lat_lng').click(function () {
                //var lat = $(this).next().val()
                //alert(lat);
                //var lng = $(this).next().next().val()
                //alert(lng);

                var city = $('#fCityID').find('option:selected').text();
                var area = $('#fAreaID').find('option:selected').text();
                var address = city + area + document.getElementById("fAddress").value;

                var _address_latitude;
                var _address_longitude;
                //alert(address);

                $('#map3').css("display", "block");
                $("map3").empty();
                var myOptions = {
                    zoom: 13,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                };
                var map = new google.maps.Map(document.getElementById("map3"), myOptions);
                var initialLocation;

                var geocoder = new google.maps.Geocoder();
                geocoder.geocode({ 'address': address }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {

                        _address_latitude = parseFloat(results[0].geometry.location.lat()).toFixed(5).toString();//緯度，轉型固定五位小數，再轉成字串
                        _address_longitude = parseFloat(results[0].geometry.location.lng()).toFixed(5).toString();//經度，轉型固定五位小數，再轉成字串

                        document.getElementById('fLatitude').value = _address_latitude;
                        document.getElementById('fLongitude').value = _address_longitude;

                        var _lat = parseFloat(_address_latitude);
                        var _lng = parseFloat(_address_longitude);
                        var myLatLng = { lat: _lat, lng: _lng };
                        initialLocation = new google.maps.LatLng(_lat, _lng);
                        map.setCenter(initialLocation);
                        var marker = new google.maps.Marker({
                            position: myLatLng,
                            map: map,
                            //draggable: true,
                            animation: google.maps.Animation.DROP,
                            title: '您的餐廳位置',
                        });
                    }
                })

            })

            //----demo
            $('#demo').click(function () {
                $('#fEmail').val("pretty@gmail.com");
                $('#fPassword').val("0000");
                $('#fPasswordConfirm').val("0000");
                
                $('#fBirth').val("2015-10-10");
                $('#fMemeberName').val("美而美");
                $('#fTel').val("(02)2560-4012");
               
                $('#fAddress').val("台北市中山區天祥路44號");

            })


        })



    </script>



}



