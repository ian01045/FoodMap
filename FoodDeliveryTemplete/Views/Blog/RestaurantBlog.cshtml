@model FoodDeliveryTemplete.ViewModels.RestaurantBlogViewModels

<!--主版-->
@{
    ViewBag.Title = "食速列車-餐廳部落格";
    Layout = "~/Views/Blog/_BlogPage.cshtml";
}
@section style
{

    <link href="~/css/blog/default.css" rel="stylesheet" />
    <link href="~/css/blog/component.css" rel="stylesheet" />
    <link href="~/css/blog/blogtab.css" rel="stylesheet" />
<link href="~/Content/MessageBoard/Index.css" rel="stylesheet" />
<link href="~/css/blog/comment.css" rel="stylesheet" />
    <style>
            .cart h1, h2, h3, h4, h5, h6 {
                font-family: '標楷體';
                padding-left: 10px;
            }

            .cart-footer {
                background-color: white;
            }

            .btn-warning {
                font-family: '標楷體';
                font-size: 18px;
            }

            .panel-body {
                padding-left: 5px;
                padding-right: 5px;
                background-color: white;
            }

            .cart {
                background: #fcf0de;
                border: 2px solid #fca037;
                margin-left: 20px;
                width: 100%;
            }

            .checkout-hr-border {
                color: #fca037;
                background: #fca037;
            }

            .cart-footer {
                background: #ffffff;
            }

            .panel-heading {
                background: #ffffff;
                border-bottom: 1px solid #eeeeee;
            }

            label {
                display: block;
                cursor: pointer;
            }

            .form-control {
                display: block;
                width: 100%;
                height: 39px;
                padding: 6px 12px;
                font-size: 14px;
                line-height: 1.42857143;
                color: #555;
                background-color: #fff;
                background-image: none;
                border: 1px solid #ccc;
                border-radius: 4px;
                -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
                box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
                -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
                -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
                transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
            }

            .profile {
                min-height: 355px;
                display: inline-block;
            }

            figcaption.ratings {
                margin-top: 20px;
            }

                figcaption.ratings a {
                    color: #f1c40f;
                    font-size: 11px;
                }

                    figcaption.ratings a:hover {
                        color: #f39c12;
                        text-decoration: none;
                    }

            /*.emphasis {
                border-top: 4px solid transparent;
            }*/

            .emphasis:hover {
                border-top: 4px solid #1abc9c;
            }

            .emphasis h2 {
                margin-bottom: 0;
            }

            span.tags {
                background: #1abc9c;
                border-radius: 2px;
                color: #f5f5f5;
                font-weight: bold;
                padding: 2px 4px;
            }

            .dropdown-menu {
                background-color: #34495e;
                box-shadow: none;
                -webkit-box-shadow: none;
                width: 250px;
                margin-left: -125px;
                left: 50%;
            }

                .dropdown-menu .divider {
                    background: none;
                }

                .dropdown-menu > li > a {
                    color: #f5f5f5;
                }

            .dropup .dropdown-menu {
                margin-bottom: 10px;
            }

                .dropup .dropdown-menu:before {
                    content: "";
                    border-top: 10px solid #34495e;
                    border-right: 10px solid transparent;
                    border-left: 10px solid transparent;
                    position: absolute;
                    bottom: -10px;
                    left: 50%;
                    margin-left: -10px;
                    z-index: 10;
                }

            #panel-tab3 {
                border: 2px solid #fca037;
                border-radius: 4px;
            }

            #blogimg {
                height:250px;
                width: 300px;
            }

            .review-block-name {
                font-size: 12px;
                margin: 10px 0;
            }

            .review-block-date {
                font-size: 12px;
            }

            .review-block-rate {
                font-size: 13px;
                margin-bottom: 15px;
            }

            .review-block-title {
                font-size: 15px;
                font-weight: 700;
                margin-bottom: 10px;
            }

            .review-block-description {
                font-size: 13px;
            }

            .blogShort {
                border-bottom: 1px solid #ddd;
            }

            .btn-blog {
                color: #ffffff;
                background-color: #fca037;
                border-color: #ffd800;
                border-radius: 5px;
                margin-bottom: 10px;
            }

                .btn-blog:hover,
                .btn-blog:focus,
                .btn-blog:active,
                .btn-blog.active {
                    color: white;
                    background-color: #fa401e;
                    border-color: #ff6a00;
                }

            #foodimage {
                height: 70px;
                width: 90px;
                border: solid 2px #ffbd8e;
                margin-top: 10px;
                margin-bottom: 10px;
            }

            #restaurantname > p {
                font-family: '標楷體';
            }

            /*#foodshow {
                border:2px solid#fca037;
                border-radius:5px;
            }*/
            #cartindexdiv div {
                color: black;
                font-family: 'Microsoft YaHei';
            }

            html > /**/ body #fFoodImage {
                height: 300px !important;
            }

            .captionshow {
                max-height: 146px;
                overflow: auto;
            }

            #cartindexdiv div {
                color: black;
                font-family: 'Microsoft YaHei';
            }

            #cartindexdiv img {
                height: 100px;
            }

            .captionshow {
                max-height: 146px;
                overflow: hidden;
            }
      
            /*數量*/
            /*.container {
            margin-top: 50px;
            margin-left: 50px;
        }*/

            /*button.qty-change {
            height: 30px;
            width: 30px;
            border-radius: 50%;
            background: #fff;
            border: 1px solid #e3e3e3;
        }

        .qty-input {
            height: 30px;
            width: 80px;
            text-align: center;
        }*/
            #loading {
                display: none;
            }

        .alink {
            font-family: '標楷體';
            color: #0094ff;
            font-size: 16px;
        }

        #wait {
            display: none;
            position: absolute;
            height: 95%;
            width: 89%;
            background-color: rgba(167, 153, 153, 0.44);
            z-index: 9999;
        }

            #wait img {              
                left: 45%;
                z-index: 100000;
                top: 45%;
                position: absolute;
            }
        #messagesTable > .list-group-item {
                margin-bottom: 1%;
                border: 1px solid #FFC107;
                border-radius:4px
        }
        #msgshow > span {
            font-family:'標楷體';
            color: #fca037;
            font-size:18px;
            font-weight:800;
            padding-left:0;
        }
        #timeshow {
             font-family:'標楷體';
            color: #139808;
            font-size:14px;
            font-weight:500;
            padding-left:10px;
        }
        .msgdiv {
            background: #fcf0de;
            border: 2px solid #f39c12;
            margin-left: 20px;
            width: 100%;
        }

        #txtmsg {
            max-width: 100%;
            background-color:rgba(245, 179, 116, 0.49);
            font-family:'標楷體';
        }
        .fFoodImage {
            width:130px;
            height:100px;
        }
         .sub-Item {
            width: 48%;
            display: inline-block;
        }

        .modal-body hr {
            margin: 0;
        }
    </style>
}


<div class="container" style="margin-top:50px;margin-bottom: 100px;">
    <div class="panel with-nav-tabs panel-warning" style="border:none">
        <div class="panel-heading">
            <ul class="nav nav-tabs">
                <li class="active">
                    <a href="#tab1warning" data-toggle="tab">餐廳美食</a>
                </li>
                <li>
                    <a href="#tab2warning" data-toggle="tab">訂單評價</a>
                </li>
                <li>
                    <a href="#tab3warning" data-toggle="tab">餐廳資訊</a>
                </li>
                <li>
                    <a href="#tab4warning" data-toggle="tab">餐廳留言板</a>
                </li>
                <li>
                    <a href="#tab5warning" data-toggle="tab">餐廳消息板</a>
                </li>
            </ul>
        </div><!--Tab1-->
        <div class="panel-body" style="background-color:rgb(255, 255, 255);padding-right:5px;padding-left: 0px;">
            <div class="col-md-9" style="padding-left: 0px;">
                <div class="tab-content">
                    <div class="tab-pane fade in active" id="tab1warning">
                        <div class="col-md-3 col-sm-4" style="padding-left: 0px;">
                            <nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left cbp-spmenu-open" id="cbp-spmenu-s1">
                                <h3>菜單類別</h3>
                                @Html.Action("Nav", "Cart", new { _fRestaurantID = Model.fRestaurantID })
                            </nav>
                        </div>
                        <div id="foodshow" class="col-md-9 col-sm-8">
                            <!--放置餐點-->

                        </div>
                    </div>
                    <div class="tab-pane fade" id="tab2warning">
                        <div class="col-md-12 col-sm-12" style="padding-left:0;padding-right:0;">
                            <div class="panel panel-warning" style="margin-bottom:0">
                                <div class="panel-heading"><h3 style="margin-top:5px;margin-bottom:5px;">@Model.fRestaurantName</h3></div>
                                <div id="showcomment" class="panel-body"    >

                                </div>
                            </div>
                        </div>
                    </div><!--Tab2-->
                    <div class="tab-pane fade" id="tab3warning">
                        <!--Tab3-->
                        <div class="panel-body" id="panel-tab3">
                            <div class="col-md-12 col-sm-12">
                                <div class="col-sm-12">
                                    <div id="restaurantname" class="col-xs-6 col-sm-6">
                                        <h3 style="padding-left:0; font-size:20px">@Model.fRestaurantName  資訊</h3>
                                        <p>
                                            <strong>分類: </strong> 日本料理 > 生魚片
                                        </p>
                                        <p>
                                            <strong>公休日: </strong> @Model.fRoutine_RestDay_per_week_
                                        </p>
                                        <p>
                                            <strong>付款方式: </strong> 貨到付款、電子錢包
                                        </p>
                                        @*<p>
                                                <strong>Skills: </strong>
                                                <span class="tags">html5</span>
                                                <span class="tags">css3</span>
                                                <span class="tags">jquery</span>
                                                <span class="tags">bootstrap3</span>
                                            </p>*@
                                    </div>
                                    <div class="col-xs-6 col-sm-6 text-center">
                                        <figure>
                                            <img id="blogimg" class="img-thumbnail img-responsive" src="@Url.Action("GetBlogImage","Blog",new {id=Model.fPhotoID })" />
                                            <figcaption class="ratings">
                                                <p>
                                                    快來給您的評價:
                                                    <a href="#">
                                                        <span class="fa fa-star"></span>
                                                    </a>
                                                    <a href="#">
                                                        <span class="fa fa-star"></span>
                                                    </a>
                                                    <a href="#">
                                                        <span class="fa fa-star"></span>
                                                    </a>
                                                    <a href="#">
                                                        <span class="fa fa-star"></span>
                                                    </a>
                                                    <a href="#">
                                                        <span class="fa fa-star-o"></span>
                                                    </a>
                                                </p>
                                            </figcaption>
                                        </figure>
                                    </div>
                                </div>
                                <div class="col-xs-12 divider text-center">
                                    <div id="divshowlike" class="col-xs-6 col-sm-6 emphasis">
                                        <h3  style="color:skyblue">
                                            <strong> @Model.CountStar 個人說讚</strong>
                                        </h3>
                                        <button class="btn btn-success btn-block"><span class="glyphicon glyphicon-thumbs-up"></span> 登入會員給我個讚吧! </button>
                                    </div>
                                    <div class="col-xs-6 col-sm-6 emphasis">
                                        <h3 style="color:lightskyblue">
                                            <strong>趕快把我加到您的最愛吧</strong>
                                        </h3>
                                        <button class="btn btn-info btn-block"><span class="glyphicon glyphicon-heart"></span> 登入會員把我加到我的最愛 </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="tab4warning"><!--放置留言-->
                        <div class="row">
                            <div class="col-md-3">
                                <div class="panel msgdiv">
                                    <div class="panel-body" id="wait">
                                        <img src="http://i.stack.imgur.com/FhHRx.gif" />
                                    </div>
                                    <div class="panel-heading">
                                        <div class="panel-title">
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <h4>
                                                        <span class="glyphicon glyphicon-comment"></span> 訪客留言
                                                    </h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="" class="panel-body">
                                        <div class="col-xs-12">
                                            <textarea id="txtmsg" placeholder="寫下您的留言吧" style="overflow-y:hidden; height:100px;" onpropertychange="this.style.height=this.scrollHeight + 'px'" oninput="this.style.height=this.scrollHeight + 'px'"></textarea>
                                        </div>                                       
                                    </div>
                                    <div class="panel-footer cart-footer">                                        
                                        <div class="row text-center">
                                            <div class="col-xs-12 col-sm-12 col-md-12">
                                                <button class="btn btn-block btn-warning" id="btnsendmsg">
                                                    送出留言
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div id="messagesTable"></div>
                            </div>                           
                        </div>
                    </div>
                    @*濠銘用的*@
                    <div class="tab-pane fade newsboard" id="tab5warning">
                        <div class="col-md-12 col-sm-12" style="padding-left:0;padding-right:0;">
                            <div class="col-sm-12">
                                <div class="col-sm-3 newsnav" id="newstype">
                                    @Html.Action("NavCategoryForBlog", "RestaurantNews", new { Area = "Restaurant", id = Model.fRestaurantID })
                                </div>
                                <div class="col-sm-9 manynews" id="news">

                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel cart">
                    <div class="panel-body" id="wait">
                        <img src="http://i.stack.imgur.com/FhHRx.gif" />
                    </div>
                    <div class="panel-heading">
                        <div class="panel-title">
                            <div class="row">
                                <div class="col-xs-12">
                                    <h4>
                                        <span class="glyphicon glyphicon-shopping-cart"></span> 您的餐點
                                    </h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div id="blogorderseee" class="panel-body">
                            <!--購物車-->


                        </div>
                       
                    </div><!--包div的-->
                </div>
            </div>
        </div>
    </div>
</div>

<div class="bg"></div><!--登入效果黑屏-->
<div id="loginmodal" class="content45">
    <!--會員登入畫面-->
    <h3>會員登入</h3>@Html.ActionLink("註冊會員", "ForgotPassword", "Account", new { @class = "pull-right alink" })
    @using (Html.BeginForm("Login", "Account", FormMethod.Post, new { id = "loginform" }))
    {
        <div id="failLogin" class="col-sm-12">

        </div>
        @Html.LabelFor(model => model.Account)
        @Html.EditorFor(model => model.Account, new { htmlAttributes = new { @class = "txtfield", tabindex = "1" } })
        @Html.LabelFor(model => model.Password)
        @Html.EditorFor(model => model.Password, new { htmlAttributes = new { @class = "txtfield", tabindex = "2" } })
        <label for="Check">
            <a href="@Url.Action("ForgotPassword","Account",null)" class="pull-right alink" data-transition="fade">忘記密碼?</a>
            <input type="checkbox" name="Check" id="Check" value="Yes" />記住我
        </label>
        <div class="center">
            <input type="submit" name="loginbtn" id="loginbtn" class="btn btn-login" value="登入" tabindex="3">
            <input type="submit" name="shit" id="shit" class="btn btn-login" style="visibility:hidden">
        </div>
        <div style="margin-top:5px">
            <a class="btn btn-danger" id="memberbtn">會員</a>
            <a class="btn btn-success" id="restbtn">美而美</a>
            <a class="btn btn-info" id="dozo">Dozo</a>
        </div>
        <img id="loading" src="~/images/Loading/ajax-loader (4).gif" />  <img id="loading" src="~/images/Loading/ajax-loader (4).gif" />
    }
</div>

<script src="~/Scripts/jquery-1.11.1.min.js"></script>
@section script
{ 
<script src="~/Scripts/jquery.signalR-2.2.1.js"></script>
<script src="~/signalr/hubs"></script>

    <script>
        $(function () {


            $('#showcomment').load("@Url.Action("ShowCommentandStar", "Blog",new {id = Model.fRestaurantID})")
            $('#blogorderseee').load("@Url.Action("PartialCartList", "Cart",new {Area="" })?fCartID=" + '@ViewBag.fCartID');
            var cid = 1;
            var d = "N";
            $('#foodshow').load('@Url.Action("Indexx","Cart")/'+cid+'?IsMeal='+d+'');

            //濠銘
            @*$('#newstype').load("@Url.Action("NavCategoryForBlog","RestaurantNews",new { Area = "Restaurant", id = Model.fRestaurantID })")*@

            $('#news').load('@Url.Action("NewsForblog", "RestaurantNews",new { Area = "Restaurant", id = Model.fRestaurantID })'+'/?categoryid=' + $('#ligroup>li:eq(0)').addClass('active').attr('data-categoryid'));

            $('#newstype').on('click', 'li', function () {
                var categoryid = $(this).data("categoryid");

                var strUrl = '@Url.Action("NewsForblog", "RestaurantNews", new { Area= "Restaurant",id= Model.fRestaurantID})'+'?categoryid='+"navid"
                strUrl=strUrl.replace("navid",categoryid);

                $('#news').load(strUrl);
                $('#ligroup>li').removeClass('active');
                $(this).addClass("active");
            })


            //註冊a的click事件，並寫數量減少的事件
            $("#blogorderseee").on("click", ".quanminus", function (e) {
                var qua = $(this).siblings('input');
                var intqua = parseInt(qua.val());
                if (intqua > 1) {
                    qua.val(intqua - 1);
                }
                $('#wait').show();
                var quantity = $(this).siblings('.qant').attr('name');
                var Modified = "@Url.Action("PartialModifiedQuan", "Cart")";
                var JsonData = JSON.stringify({ "fRecordID": quantity, "quantity": qua.val() });
                $.ajax({
                    url: Modified,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JsonData
                }).done(function (data) {
                    var cartID = data._fCartID;
                    $('#wait').hide(1000);
                    $('#blogorderseee').load("@Url.Action("PartialCartList", "Cart",new {Area="" })?fCartID=" + cartID)
                });

            });
            //數量增加
            $("#blogorderseee").on("click", ".quanplus", function () {
                var qua = $(this).siblings('input');
                var intqua = parseInt(qua.val());
                qua.val(intqua + 1);
                var quantity = $(this).siblings('.qant').attr('name');
                var Modified = "@Url.Action("PartialModifiedQuan", "Cart")";
                var JsonData = JSON.stringify({ "fRecordID": quantity, "quantity": qua.val() });
                $('#wait').show();
                $.ajax({
                    url: Modified,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JsonData
                }).done(function (data) {
                    var cartID = data._fCartID;
                    $('#wait').hide(1000);
                    $('#blogorderseee').load("@Url.Action("PartialCartList", "Cart")?fCartID=" + cartID)
                });
            });
            //註冊刪除事件
            $('#blogorderseee').on("click", ".deletefood", function () {
                $('#wait').show();
                var deleteID = $(this).attr("name");
                var Delete = "@Url.Action("PartialDelete", "Cart")";
                var JsonData = JSON.stringify({ "fRecordID": deleteID });
                $.ajax({
                    url: Delete,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JsonData
                }).done(function (data) {
                    var cartID = data._fCartID;
                    $('#wait').hide(1500);
                    $('#blogorderseee').load("@Url.Action("PartialCartList", "Cart")?fCartID=" + cartID)
                });
            });

            //套餐
            $('#cbp-spmenu-s1').on("click",".linkformeal",function(){              
                $('#foodshow').fadeOut(1000, function () {
                    $('#foodshow').load('@Url.Action("Indexx","Cart",new {Area="",IsMeal="Y"})', function () {
                        $('#foodshow').fadeIn(1000);
                    });
                });
            })

            //NavBar點選到連結的餐點
            $('#cbp-spmenu-s1').on('click',".ohmygod", function () {
                var id = $(this).attr("id");
                var n = "N";
                console.log(id)
                $('#foodshow').fadeOut(1000, function () {
                    $('#foodshow').load('@Url.Action("Indexx","Cart")/'+id+'?IsMeal='+n+'', function () {
                        $('#foodshow').fadeIn(1000);
                    });
                });
            });

            ///小紅的購物車購買選擇數量的事件
            $("#foodshow").on("click",".quantity-right-plus", function (e) {
                var ID = $(this).parents(".input-group").children(".quantity");
                var quantity = parseInt(ID.val());
                ID.val(quantity + 1);
                console.log(ID.val())
            });
            $("#foodshow").on("click",".quantity-left-minus", function (e) {
                var ID = $(this).parents(".input-group").children(".quantity");
                var quantity = parseInt(ID.val());
                if (quantity > 0) { ID.val(quantity - 1); }
                console.log(ID.val())
            });
            var cartID
            $("#foodshow").on("click",".gotoCart", function (e) {

                //將food顯示在blogorders上
                var Cart = '@Url.Action("AddToCart","Cart",new {Area=""})';
                var quan = $(this).siblings('.fooddetailcontainer').find("input").val();
                var CCID = $(this).parents(".gotocartcontainer").find("select > option:selected").val();//客製化選項(select下拉選單)
                if(CCID!=null){
                    var IntCCID = parseInt(CCID);
                }
                else{
                    var IntCCID = 0;                
                }
              
                console.log(IntCCID);
                var JsonData = JSON.stringify({ "fFoodID": $(this).val(),"id":quan,"CCID":IntCCID});
                $.ajax({
                    url: Cart,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JsonData
                }).done(function (data) {
                    cartID = data._fCartID;
                    $('#blogorderseee').load('@Url.Action("PartialCartList", "Cart",new {Area="" })'+"?fCartID=" + cartID)
                });//ajax結束
            });

            //Demo鍵
            $('#memberbtn').on('click', function (e) {
                e.preventDefault();
                $('#Account').val('b96613009@ntu.edu.tw');
                $('#Password').val('0000');
            })
            $('#restbtn').on('click', function (e) {
                e.preventDefault();
                $('#Account').val('pretty@gmail.com')
                $('#Password').val('0000');
            })
            $('#dozo').on('click', function (e) {
                e.preventDefault();
                $('#Account').val('dozo@gmail.com');
                $('#Password').val('0000');
            })

            //會員登入
            $('#loginbtn').click(function (e) {
                var failMsg = "@Url.Action("failLogin","Account")"
                var JsonData = JSON.stringify({ "Account": $('#Account').val(), "Password": $('#Password').val(), "Check": $('#Check').val() });
                e.preventDefault();
                $.ajax({
                    url: failMsg,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JsonData
                })
                .done(function (data) {
                    if (data.fail != null && data.fail != "") {
                        var failLogin = $('#failLogin').append("<div ></div>").addClass("alert alert-danger").attr("role", "alert")
                        failLogin.append('<span></span>').addClass("glyphicon glyphicon-exclamation-sign").attr("aria-hidden", "true").text(data.fail)
                    } else {
                        $('#shit').click();
                    };
                });
            });

            //留言送出
            $('#btnsendmsg').click(function () {
                var sendMsg = "@Url.Action("SendMessage", "Message")"
                var JsonData = JSON.stringify({ "content": $('#txtmsg').val(),"id":@Model.fRestaurantID});
                $.ajax({
                    url: sendMsg,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JsonData
                }).done(function () {
                    $('#txtmsg').val("")
                })
            })


            var notifications = $.connection.messagesHub;

            //debugger;
            // Create a function that the hub can call to broadcast messages.
            notifications.client.updateMessages = function () {
                getAllMessages()

            };
            // Start the connection.
            $.connection.hub.start({ transport: 'longPolling' }).done(function () {
                getAllMessages();
            }).fail(function (e) {
                alert(e);
            });


        });
        function getAllMessages()
        {
            var msgURL = "@Url.Action("GetMessages", "Message")";
            var tbl = $('#messagesTable');
            $.ajax({
                url: msgURL,
                contentType: 'application/html ; charset:utf-8',
                type: 'GET',
                dataType: 'html'
            }).success(function (result) {
                tbl.empty().append(result);
            }).error(function () {

            });

        }
    </script>
}
